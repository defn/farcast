#!/usr/bin/env bash

function main {
  if [[ "$#" -gt 0 ]]; then
    source /app/venv/bin/activate
    exec "$@"
    return $?
  fi

  set -x

  if [[ -S /docker.sock ]]; then
    sudo mkdir -p /var/run
    sudo ln -nfs /docker.sock /var/run/docker.sock
  fi

  exec /usr/sbin/sshd -D -o UseDNS=no -o UsePAM=yes -o PasswordAuthentication=no -o Port=2222 -e
}

main "$@"
